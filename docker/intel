# Start from latest ubuntu
FROM intel/oneapi-basekit

RUN useradd -ms /bin/bash plumed
USER plumed
WORKDIR /home/plumed

# import plumed code.
# assumes a file plumed2.tgz is present in the Dockerfile directory
COPY plumed2.tgz /home/plumed

# build and test plumed (no install)
RUN . /etc/bashrc \
 && export PATH=$HOME/opt/bin:$PATH \
 && export CPATH=$HOME/opt/include:$CPATH \
 && export INCLUDE=$HOME/opt/include:$INCLUDE \
 && export LIBRARY_PATH=$HOME/opt/lib:$LIBRARY_PATH \
 && export LD_LIBRARY_PATH=$HOME/opt/lib:$LD_LIBRARY_PATH \
 && tar xzf plumed2.tgz \
 && cd plumed2 \
 && .travis/install.boost release \
 && .travis/install.xdrfile \
 && ./configure --enable-modules=all --enable-boost_serialization \
 && make -j 4 \
 && make check

